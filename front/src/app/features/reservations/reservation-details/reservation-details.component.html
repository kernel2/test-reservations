<div class="container mt-4">
    <h2>Détails de la Réservation {{ reservationId }}</h2>
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="needs-validation" novalidate>
        <div formArrayName="trips">
            <div *ngFor="let trip of trips().controls; let i = index;" [formGroupName]="i"
                class="mb-4 border p-3 rounded">
                <h5>Trip {{ i + 1 }}</h5>

                <div class="row align-items-center">
                    <div class="col-md-3">
                        <label for="busNumber-{{i}}" class="form-label">Bus Number</label>
                        <select id="busNumber-{{i}}" class="form-select" formControlName="busNumber"
                            (change)="onBusSelection(i)" required
                            [ngClass]="{'is-invalid': trip.get('busNumber')?.invalid && trip.get('busNumber')?.touched}">
                            <option value="" disabled>Select Bus</option>
                            <option *ngFor="let bus of getAvailableBuses(i)" [value]="bus.busNumber">{{ bus.busNumber }}
                            </option>
                        </select>
                        <div *ngIf="trip.get('busNumber')?.invalid && trip.get('busNumber')?.touched"
                            class="invalid-feedback">
                            Bus number is required.
                        </div>
                    </div>

                    <div class="col-md-3" *ngIf="trip.get('busNumber')?.value">
                        <label for="dateOfTravel-{{i}}" class="form-label">Date and Time</label>
                        <input type="text" id="dateOfTravel-{{i}}" class="form-control" formControlName="dateOfTravel"
                            [readonly]="true" />
                    </div>

                    <div class="col-md-3" *ngIf="trip.get('busNumber')?.value">
                        <label for="price-{{i}}" class="form-label">Price</label>
                        <input type="number" id="price-{{i}}" class="form-control" formControlName="price"
                            [readonly]="true" />
                    </div>

                    <div class="col-md-3 d-flex align-items-end">
                        <button type="button" class="btn btn-danger btn-remove-trip" (click)="removeTrip(i)">Remove
                            Trip</button>
                    </div>
                </div>
            </div>

            <div class="mt-3">
                <button type="button" class="btn btn-primary" (click)="addTrip()">Add Trip</button>
            </div>
        </div>

        <div class="mt-4">
            <label for="totalPrice" class="form-label">Total Price</label>
            <input type="number" id="totalPrice" class="form-control" formControlName="totalPrice"
                [ngClass]="{'is-invalid': form.get('totalPrice')?.invalid && form.get('totalPrice')?.touched}"
                required />
            <div *ngIf="form.get('totalPrice')?.invalid && form.get('totalPrice')?.touched" class="invalid-feedback">
                Total price is required.
            </div>
        </div>

        <div class="btn-group" role="group">
            <button type="submit" class="btn btn-outline-success btn-sm" [disabled]="form.invalid">Sauvegarder</button>
            <button class="btn btn-outline-primary btn-sm ml-4" [disabled]="form.invalid" [routerLink]="['/reservations']">Retour</button>
        </div>
    </form>


</div>